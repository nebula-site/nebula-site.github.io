<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile â€“ Nebula</title>
  <link rel="icon" type="image/x-icon" href="/images/favicon.png" />
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/navbar.css" />
  <link rel="stylesheet" href="/css/desc.css" />
  <link rel="stylesheet" href="/css/home.css" />

  <!-- Optional site scripts (kept deferred) -->
  <script src="/js/main.js" defer></script>
  <script src="/js/game-menu.js" defer></script>
  <script src="/js/navbar.js" defer></script>
  <script src="/js/profile.js" defer></script>
  <script src="/js/home.js" defer></script>
  <script src="/js/particles.js" defer></script>
  <script src="/js/particles-config.js" defer></script>

  <style>
    /* Styles (kept from original file) */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: linear-gradient(135deg, #1a0033 0%, #0d001f 100%); color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
    main { max-width: 900px; margin: 40px auto; padding: 24px; text-align: left; background: rgba(255,255,255,0.05); border-radius: 16px; box-shadow: 0 4px 24px rgba(0,0,0,0.2); backdrop-filter: blur(8px); flex: 1; width: 90%; }
    h1 { color: #a3f7ff; text-align: center; margin-bottom: 12px; }
    h2 { color: #a3f7ff; margin-bottom: 12px; }
    p { color: #ccc; }
    #profile-status { text-align: center; color: #ccc; margin-bottom: 24px; }
    .btn { padding: 10px 16px; border-radius: 8px; color: white; border: 0; cursor: pointer; transition: 0.2s; font-weight: 500; font-size: 0.95rem; }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: #1a73e8; }
    .btn-primary:hover { background: #1557b0; }
    .btn-secondary { background: #6c5ce7; }
    .btn-secondary:hover { background: #5f46d4; }
    .btn-danger { background: #ff6b6b; }
    .btn-danger:hover { background: #ee5a52; }
    .btn-tertiary { background: #00b894; }
    .btn-tertiary:hover { background: #00a584; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    #profile-card { display: none; align-items: center; gap: 24px; padding: 24px; border-radius: 12px; background: rgba(30,0,60,0.12); margin-bottom: 24px; }
    #profile-card.show { display: flex; }
    #profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid rgba(163,247,255,0.3); flex-shrink: 0; }
    .profile-info { flex: 1; }
    .profile-info div { margin-bottom: 12px; }
    .label { opacity: 0.7; font-size: 0.85rem; color: #a3f7ff; text-transform: uppercase; letter-spacing: 0.5px; }
    .value { font-weight: 500; color: white; font-size: 1.1rem; }
    .profile-actions { display: flex; gap: 8px; margin-top: 16px; }
    .auth-section { text-align: center; }
    .auth-buttons { margin-top: 16px; display: flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; }
    hr { margin: 24px 0; border: 0; height: 1px; background: rgba(255,255,255,0.2); }
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(4px); align-items: center; justify-content: center; }
    .modal.show { display: flex; }
    .modal-content { background: rgba(30,0,60,0.95); padding: 32px; border-radius: 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.3); border: 1px solid rgba(163,247,255,0.2); max-width: 500px; width: 90%; }
    .modal-content h2 { margin-bottom: 20px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #a3f7ff; font-size: 0.9rem; font-weight: 600; }
    .form-group input { width: 100%; padding: 12px; border: 1px solid rgba(163,247,255,0.3); border-radius: 8px; background: rgba(255,255,255,0.05); color: white; font-size: 0.95rem; }
    .form-group input:focus { outline: none; border-color: #a3f7ff; background: rgba(255,255,255,0.1); }
    .avatar-preview { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 2px solid rgba(163,247,255,0.3); margin-top: 8px; }
    .file-input-wrapper { position: relative; display: inline-block; margin-top: 12px; }
    #avatarUpload { display: none; }
    .upload-btn { padding: 10px 16px; background: #6c5ce7; color: white; border: 1px dashed rgba(163,247,255,0.5); border-radius: 8px; cursor: pointer; transition: 0.2s; }
    .upload-btn:hover { background: #5f46d4; border-color: #a3f7ff; }
    .modal-buttons { display: flex; gap: 8px; margin-top: 24px; }
    .modal-buttons button { flex: 1; }
    footer { background: rgba(30,0,60,0.9); color: white; padding: 20px; text-align: center; border-top: 2px solid #3f00ff88; margin-top: auto; }
    footer a { color: #a3f7ff; margin: 0 10px; text-decoration: none; }
    footer a:hover { text-decoration: underline; }
    .icon { width: 80px; height: 80px; margin: 40px auto 20px; display: block; }
    .error { background: rgba(255,107,107,0.1); border: 1px solid #ff6b6b; color: #ff8787; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 0.9rem; }
    .success { background: rgba(0,184,148,0.1); border: 1px solid #00b894; color: #1dd1a1; padding: 12px; border-radius: 8px; margin-bottom: 16px; font-size: 0.9rem; }
    .switch-auth-text { text-align: center; margin-top: 16px; color: #aaa; font-size: 0.9rem; }
    .switch-auth-text button { background: none; border: none; color: #a3f7ff; cursor: pointer; text-decoration: underline; font-weight: 600; }
    .switch-auth-text button:hover { color: #fff; }
  </style>
</head>

<body>
  <img class="icon" src="images/favicon.png" alt="Nebula Icon">

  <main>
    <h1>Your Profile</h1>
    <p id="profile-status">Not signed in.</p>
    <div id="error-message" class="error" style="display: none;"></div>
    <div id="success-message" class="success" style="display: none;"></div>

    <!-- Profile Card (when signed in) -->
    <section id="profile-card">
      <img id="profile-pic" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23a3f7ff' opacity='0.2'/%3E%3Ccircle cx='50' cy='50' r='35' fill='none' stroke='%23a3f7ff' stroke-width='2'/%3E%3C/svg%3E" alt="avatar">
      <div class="profile-info">
        <div>
          <div class="label">Username</div>
          <div class="value" id="profile-name">User</div>
        </div>
        <div>
          <div class="label">Email</div>
          <div class="value" id="profile-email">user@example.com</div>
        </div>
        <div class="profile-actions">
          <button class="btn btn-secondary" id="editProfileBtn">âœŽ Edit Profile</button>
          <button class="btn btn-danger" id="signOutBtn">Sign Out</button>
        </div>
      </div>
    </section>

    <hr>

    <!-- Auth Section (when not signed in) -->
    <section id="auth-section" class="auth-section">
      <h2>Welcome to Nebula</h2>
      <p>Sign in or create an account to get started</p>
      <div class="auth-buttons">
        <button class="btn btn-primary" id="signInBtn">Sign In</button>
        <button class="btn btn-secondary" id="signUpBtn">Sign Up</button>
        <!-- GitHub OAuth button (saves email to localStorage after login) -->
      </div>
    </section>
  </main>

  <!-- Sign In Modal -->
  <div id="signInModal" class="modal">
    <div class="modal-content">
      <h2>Sign In</h2>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="signInEmail" placeholder="your@email.com" />
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="signInPassword" placeholder="Enter your password" />
      </div>
      <div class="modal-buttons">
        <button class="btn btn-tertiary" id="loginBtn">Sign In</button>
        <button class="btn btn-danger" id="closeSignInBtn">Cancel</button>
      </div>
      <div class="switch-auth-text">
        Don't have an account? <button id="switchToSignUp">Sign Up</button>
      </div>
    </div>
  </div>

  <!-- Sign Up Modal -->
  <div id="signUpModal" class="modal">
    <div class="modal-content">
      <h2>Create Account</h2>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="signUpEmail" placeholder="your@email.com" />
      </div>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="signUpUsername" placeholder="Choose a username" />
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="signUpPassword" placeholder="At least 6 characters" />
      </div>
      <div class="modal-buttons">
        <button class="btn btn-tertiary" id="createAccountBtn">Create Account</button>
        <button class="btn btn-danger" id="closeSignUpBtn">Cancel</button>
      </div>
      <div class="switch-auth-text">
        Already have an account? <button id="switchToSignIn">Sign In</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h2>Edit Profile</h2>
      <div class="form-group">
        <label>Avatar</label>
        <img id="avatarPreview" class="avatar-preview" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23a3f7ff' opacity='0.2'/%3E%3Ccircle cx='50' cy='50' r='35' fill='none' stroke='%23a3f7ff' stroke-width='2'/%3E%3C/svg%3E" alt="avatar preview">
        <div class="file-input-wrapper">
          <input type="file" id="avatarUpload" accept="image/*" />
          <button type="button" class="upload-btn" id="uploadAvatarBtn">ðŸ“¤ Upload Avatar</button>
        </div>
      </div>
      <div class="form-group">
        <label>Username</label>
        <input type="text" id="editUsername" placeholder="Enter your username" />
      </div>
      <div class="modal-buttons">
        <button class="btn btn-tertiary" id="saveProfileBtn">Save Changes</button>
        <button class="btn btn-danger" id="closeEditBtn">Cancel</button>
      </div>
    </div>
  </div>

  <footer>
    <p style="margin: 0;">Nebula â€” gaming meets reality!</p>
    <nav style="margin-top: 8px;">
      <a href="/privacy.html">Privacy Policy</a>
      <a href="/terms.html">Terms of Service</a>
      <a href="/contact.html">Contact Us</a>
    </nav>
  </footer>

  <!-- Supabase Auth Logic with LocalStorage (saves email too) -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // Supabase config (leave as-is or replace)
    const SUPABASE_URL = 'https://lhurtuuxsmlakoikcpiz.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxodXJ0dXV4c21sYWtvaWtjcGl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1OTIyNjEsImV4cCI6MjA3OTE2ODI2MX0.NiXIlUukeNB-gOANdbHSyfb6T9GcO7QqtlMsQgkEGKc';

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('Supabase initialized:', !!supabase);

    const defaultAvatar = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"%3E%3Ccircle cx="50" cy="50" r="45" fill="%23a3f7ff" opacity="0.2"/%3E%3Ccircle cx="50" cy="50" r="35" fill="none" stroke="%23a3f7ff" stroke-width="2"/%3E%3C/svg%3E';

    // --------------------------
    // localStorage helpers (email included)
    // --------------------------
    function saveToLocalStorage(username, avatarUrl, email) {
      try {
        if (username !== undefined && username !== null) localStorage.setItem('nebula_username', username);
        if (avatarUrl !== undefined && avatarUrl !== null) localStorage.setItem('nebula_avatar', avatarUrl);
        if (email !== undefined && email !== null) localStorage.setItem('nebula_email', email);
        console.log('Saved to localStorage:', { username, email });
      } catch (e) {
        console.error('Error saving to localStorage:', e);
      }
    }

    function getFromLocalStorage() {
      try {
        return {
          username: localStorage.getItem('nebula_username'),
          avatar: localStorage.getItem('nebula_avatar'),
          email: localStorage.getItem('nebula_email')
        };
      } catch (e) {
        console.error('Error reading from localStorage:', e);
        return { username: null, avatar: null, email: null };
      }
    }

    function clearLocalStorage() {
      try {
        localStorage.removeItem('nebula_username');
        localStorage.removeItem('nebula_avatar');
        localStorage.removeItem('nebula_email');
        console.log('Cleared localStorage');
      } catch (e) {
        console.error('Error clearing localStorage:', e);
      }
    }

    // --------------------------
    // UI helpers
    // --------------------------
    function showError(msg) {
      const el = document.getElementById('error-message');
      el.textContent = msg;
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 5000);
    }

    function showSuccess(msg) {
      const el = document.getElementById('success-message');
      el.textContent = msg;
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 3000);
    }

    function showProfile(userOrFake) {
      // Accept Supabase user object OR local saved object
      const metadata = (userOrFake && userOrFake.user_metadata) ? userOrFake.user_metadata : {};
      const name = metadata.full_name || userOrFake?.full_name || userOrFake?.username || userOrFake?.name || userOrFake?.email || 'User';
      const avatar = metadata.avatar_url || userOrFake?.avatar || userOrFake?.avatar_url || defaultAvatar;
      const email = userOrFake?.email || userOrFake?.user?.email || userOrFake?.user_email || userOrFake?.user_metadata?.email || getFromLocalStorage().email || '(no email)';

      // persist locally (username/avatar/email)
      saveToLocalStorage(name, avatar, email);

      document.getElementById('profile-status').textContent = `Signed in as ${email}`;
      document.getElementById('profile-name').textContent = name;
      document.getElementById('profile-email').textContent = email;
      document.getElementById('profile-pic').src = avatar;
      document.getElementById('profile-card').classList.add('show');
      document.getElementById('auth-section').style.display = 'none';

      document.getElementById('editUsername').value = name;
      document.getElementById('avatarPreview').src = avatar;

      // dispatch a site-wide event for nav sync
      try {
        const profileObj = { name, username: name, email, picture: avatar, avatar };
        window.dispatchEvent(new CustomEvent('nebulaProfileUpdated', { detail: profileObj }));
      } catch (e) {
        console.warn('Could not dispatch nebulaProfileUpdated event', e);
      }
    }

    function hideProfile() {
      clearLocalStorage();

      document.getElementById('profile-status').textContent = 'Not signed in.';
      document.getElementById('profile-card').classList.remove('show');
      document.getElementById('auth-section').style.display = 'block';
      document.getElementById('editModal').classList.remove('show');
      document.getElementById('signInModal').classList.remove('show');
      document.getElementById('signUpModal').classList.remove('show');

      // dispatch cleared profile
      try { window.dispatchEvent(new CustomEvent('nebulaProfileUpdated', { detail: null })); } catch(e){}
    }

    // --------------------------
    // Auth state listener (capture OAuth / sign-ins)
    // --------------------------
    supabase.auth.onAuthStateChange((event, session) => {
      if (session?.user) {
        // Save email on any successful sign-in (including OAuth)
        const u = session.user;
        const name = u.user_metadata?.full_name || u.email || getFromLocalStorage().username;
        const avatar = u.user_metadata?.avatar_url || getFromLocalStorage().avatar || defaultAvatar;
        const email = u.email || getFromLocalStorage().email || '';
        saveToLocalStorage(name, avatar, email);
        showProfile(u);
      } else {
        // session ended: fallback to localStorage UI if present
        const saved = getFromLocalStorage();
        if (saved.username || saved.email) {
          showProfile({ full_name: saved.username, avatar: saved.avatar, email: saved.email || '(restored)' });
        } else {
          hideProfile();
        }
      }
    });

    // ---------- DOM event wiring ----------
    document.getElementById('signInBtn').addEventListener('click', () => {
      document.getElementById('signInModal').classList.add('show');
      document.getElementById('signInEmail').focus();
    });

    document.getElementById('closeSignInBtn').addEventListener('click', () => {
      document.getElementById('signInModal').classList.remove('show');
    });

    document.getElementById('loginBtn').addEventListener('click', async () => {
      const email = document.getElementById('signInEmail').value.trim();
      const password = document.getElementById('signInPassword').value;

      if (!email || !password) {
        showError('Please fill in all fields');
        return;
      }

      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) {
          showError('Sign in failed: ' + error.message);
          return;
        }

        // user info may be in data.user or data.session.user
        const user = data?.user || data?.session?.user;
        if (user) {
          const name = user.user_metadata?.full_name || email;
          const avatar = user.user_metadata?.avatar_url || defaultAvatar;
          saveToLocalStorage(name, avatar, email);
          showProfile(user);
        } else {
          // fallback minimal save
          saveToLocalStorage(email, defaultAvatar, email);
          showProfile({ full_name: email, email });
        }

        showSuccess('Signed in successfully!');
        document.getElementById('signInModal').classList.remove('show');
        document.getElementById('signInEmail').value = '';
        document.getElementById('signInPassword').value = '';
      } catch (e) {
        showError('Error: ' + (e.message || e));
      }
    });

    document.getElementById('signUpBtn').addEventListener('click', () => {
      document.getElementById('signUpModal').classList.add('show');
      document.getElementById('signUpEmail').focus();
    });

    document.getElementById('closeSignUpBtn').addEventListener('click', () => {
      document.getElementById('signUpModal').classList.remove('show');
    });

    document.getElementById('createAccountBtn').addEventListener('click', async () => {
      const email = document.getElementById('signUpEmail').value.trim();
      const username = document.getElementById('signUpUsername').value.trim();
      const password = document.getElementById('signUpPassword').value;

      if (!email || !password || !username) {
        showError('Please fill in all fields');
        return;
      }

      if (password.length < 6) {
        showError('Password must be at least 6 characters');
        return;
      }

      try {
        const { data, error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            data: {
              full_name: username,
              avatar_url: defaultAvatar
            }
          }
        });

        if (error) {
          showError('Sign up failed: ' + error.message);
          return;
        }

        // Save locally the new account's details (email included)
        saveToLocalStorage(username, defaultAvatar, email);
        showProfile(data?.user || { full_name: username, email });
        showSuccess('Account created successfully! You are now signed in.');
        document.getElementById('signUpModal').classList.remove('show');
        document.getElementById('signUpEmail').value = '';
        document.getElementById('signUpPassword').value = '';
        document.getElementById('signUpUsername').value = '';
      } catch (e) {
        showError('Error: ' + (e.message || e));
      }
    });

    document.getElementById('switchToSignUp').addEventListener('click', () => {
      document.getElementById('signInModal').classList.remove('show');
      document.getElementById('signUpModal').classList.add('show');
    });

    document.getElementById('switchToSignIn').addEventListener('click', () => {
      document.getElementById('signUpModal').classList.remove('show');
      document.getElementById('signInModal').classList.add('show');
    });

    // GitHub OAuth button: opens Supabase OAuth flow. onAuthStateChange saves email automatically.
    document.getElementById('githubBtn').addEventListener('click', async () => {
      try {
        // This will redirect the user to GitHub for authentication (or open popup depending on your Supabase settings)
        await supabase.auth.signInWithOAuth({ provider: 'github' });
        // after redirect/callback, onAuthStateChange will run and save email
      } catch (e) {
        showError('GitHub sign-in failed: ' + (e.message || e));
      }
    });

    document.getElementById('signOutBtn').addEventListener('click', async () => {
      try {
        await supabase.auth.signOut();
      } catch (e) {
        console.warn('Sign out error from supabase:', e);
      } finally {
        hideProfile();
        showSuccess('Signed out successfully');
      }
    });

    document.getElementById('editProfileBtn').addEventListener('click', () => {
      document.getElementById('editModal').classList.add('show');
    });

    document.getElementById('closeEditBtn').addEventListener('click', () => {
      document.getElementById('editModal').classList.remove('show');
    });

    const uploadAvatarBtn = document.getElementById('uploadAvatarBtn');
    if (uploadAvatarBtn) {
      uploadAvatarBtn.addEventListener('click', () => {
        document.getElementById('avatarUpload').click();
      });
    }

    const avatarUpload = document.getElementById('avatarUpload');
    if (avatarUpload) {
      avatarUpload.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          const base64 = event.target.result;
          document.getElementById('avatarPreview').src = base64;
          avatarUpload.dataset.base64 = base64;
        };
        reader.readAsDataURL(file);
      });
    }

    const saveProfileBtn = document.getElementById('saveProfileBtn');
    if (saveProfileBtn) {
      saveProfileBtn.addEventListener('click', async () => {
        const newUsername = document.getElementById('editUsername').value.trim();
        const avatarUploadEl = document.getElementById('avatarUpload');
        let avatarData = avatarUploadEl.dataset.base64 || null;

        if (!newUsername) {
          showError('Username cannot be empty');
          return;
        }

        try {
          const { data, error } = await supabase.auth.updateUser({
            data: {
              full_name: newUsername,
              avatar_url: avatarData || document.getElementById('avatarPreview').src
            }
          });

          if (error) {
            showError('Error updating profile: ' + error.message);
            return;
          }

          const savedAvatar = avatarData || document.getElementById('avatarPreview').src;
          // keep current email if present
          const savedEmail = getFromLocalStorage().email || (data?.user?.email) || '(restored)';
          saveToLocalStorage(newUsername, savedAvatar, savedEmail);

          showSuccess('Profile updated successfully!');
          document.getElementById('editModal').classList.remove('show');
          avatarUploadEl.value = '';
          delete avatarUploadEl.dataset.base64;

          const { data: sessionData } = await supabase.auth.getSession();
          if (sessionData?.session?.user) {
            showProfile(sessionData.session.user);
          } else {
            showProfile({ full_name: newUsername, avatar: savedAvatar, email: savedEmail });
          }
        } catch (e) {
          showError('Error: ' + (e.message || e));
        }
      });
    }

    // Bootstrapping auth UI: check Supabase session then localStorage fallback
    async function initAuth() {
      try {
        // Try to restore from a real Supabase session first
        const { data: sessionData } = await supabase.auth.getSession();
        const supaUser = sessionData?.session?.user;
        if (supaUser) {
          // ensure local saved values updated from real user
          const name = supaUser.user_metadata?.full_name || supaUser.email;
          const avatar = supaUser.user_metadata?.avatar_url || defaultAvatar;
          saveToLocalStorage(name, avatar, supaUser.email);
          showProfile(supaUser);
          return;
        }

        // If no supabase session, try localStorage
        const saved = getFromLocalStorage();
        if (saved.username || saved.email) {
          // Show local fallback UI (limited)
          showProfile({ full_name: saved.username, avatar: saved.avatar, email: saved.email });
          console.log('Restored UI from localStorage');
          return;
        }

        // Nothing to restore
        hideProfile();
      } catch (e) {
        console.error('initAuth error', e);
        // fallback to localStorage if supabase call failed
        const saved = getFromLocalStorage();
        if (saved.username || saved.email) showProfile({ full_name: saved.username, avatar: saved.avatar, email: saved.email });
      }
    }

    // Initialize on DOM ready
    window.addEventListener('DOMContentLoaded', initAuth);
  </script>
</body>

</html>
