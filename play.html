<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nebula | Play</title>

  <link rel="icon" type="image/x-icon" href="/images/favicon.png" />
  <link rel="stylesheet" href="/css/navbar.css" />
  <link rel="stylesheet" href="/css/menu.css" />
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/viewers.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {
      margin: 0;
      padding: 0;
      background: #0b0f1a;
      font-family: Arial, sans-serif;
      color: white;
    }

    #game-container {
      width: 100%;
      max-width: 1100px;
      margin-top: 20px;
      padding: 20px;
      border-radius: 16px;
      background: #111729dd;
      backdrop-filter: blur(6px);
      box-shadow: 0 0 30px #00000055;
    }

    #game-name {
      color: #a3f7ff;
      font-family: 'Bebas Neue', sans-serif;
      letter-spacing: 1px;
      font-size: 42px;
      text-shadow: 0 0 10px #00e1ff44;
    }

    /* Game image */
    #game-image {
      width: 80px;
      height: 80px;
      border-radius: 14px;
      box-shadow: 0 5px 18px #00e1ff66;
      border: 2px solid #00cfff;
    }

    /* Iframe container */
    #iframe-container {
      margin-top: 12px;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      background: #000;
    }

    #iframe-container iframe {
      width: 100%;
      height: 700px;
      border: 0;
      background: #000;
    }

    #iframe-container.fullscreen {
      position: fixed;
      inset: 0;
      border-radius: 0;
      z-index: 9999;
      background: #000;
    }

    #iframe-container.fullscreen iframe {
      height: 100%;
    }

    /* Buttons */
    .buttons-container {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      justify-content: center;
    }

    .buttons-container button {
      background: #1c2333;
      border: 1px solid #2e3b55;
      color: #d7f9ff;
      font-size: 18px;
      width: 52px;
      height: 52px;
      border-radius: 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }

    .buttons-container button:hover {
      background: #283554;
      transform: translateY(-2px);
      box-shadow: 0 0 10px #00d0ff55;
    }
  </style>
</head>

<body>
  <center>
    <div id="game-container">
      <div style="display: flex; align-items: center; justify-content: center; gap: 18px; margin-bottom: 10px;">
        <img id="game-image" src="" alt="Game Image" style="display: none;">
        <h2 id="game-name"></h2>
      </div>

      <div id="iframe-container">
        <iframe id="myIframe" src="" allow="autoplay; fullscreen; encrypted-media; picture-in-picture; web-share"
        sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
      </div>

      <div class="buttons-container">
        <button onclick="goHome()" title="Back to games">
          <i class="fa fa-house"></i>
        </button>

        <button id="fullscreenButton" onclick="makeFullscreen()" title="Fullscreen">
          <i class="fa-solid fa-expand"></i>
        </button>

        <button id="reloadButton" onclick="reloadIframe()" title="Reload">
          <i class="fa fa-rotate-right"></i>
        </button>
      </div>
    </div>
  </center>

  <div id="particles-js"></div>

  <!-- SCRIPT SECTION -->
  <script>
    function pausePageEffects() {
      const p = document.getElementById('particles-js');
      if (p) p.style.display = 'none';
      document.documentElement.style.scrollBehavior = 'auto';
    }

    function restorePageEffects() {
      const p = document.getElementById('particles-js');
      if (p) p.style.display = '';
      document.documentElement.style.scrollBehavior = '';
    }

    window.addEventListener('load', () => {
      const gameLink = sessionStorage.getItem('gameLink');
      const gameName = sessionStorage.getItem('gameName');
      const gameImage = sessionStorage.getItem('gameImage');

      if (gameLink && gameName) {
        document.getElementById('game-name').innerText = gameName;

        const imgElem = document.getElementById('game-image');
        if (gameImage) {
          imgElem.src = gameImage;
          imgElem.style.display = 'block';
        }

        startGame();
      } else {
        window.location.href = "/games";
      }
    });

    function startGame() {
      const gameLink = sessionStorage.getItem('gameLink') || '';
      const iframe = document.getElementById('myIframe');

      pausePageEffects();

      let finalSrc = gameLink;
      if (!finalSrc.startsWith('http') && !finalSrc.startsWith('/')) finalSrc = '/' + finalSrc;

      iframe.src = finalSrc;
    }

    function reloadIframe() {
      const iframe = document.getElementById('myIframe');
      const currentSrc = iframe.src;
      const reloadBtn = document.getElementById('reloadButton');

      reloadBtn.querySelector("i").classList.add("fa-spin");

      iframe.src = '';
      setTimeout(() => {
        iframe.src = currentSrc;
        reloadBtn.querySelector("i").classList.remove("fa-spin");
      }, 150);
    }

    function makeFullscreen() {
      const container = document.getElementById('iframe-container');

      if (container.requestFullscreen) container.requestFullscreen();
      else if (container.webkitRequestFullscreen) container.webkitRequestFullscreen();
      else if (container.mozRequestFullScreen) container.mozRequestFullScreen();
      else if (container.msRequestFullscreen) container.msRequestFullscreen();

      container.classList.add('fullscreen');
      pausePageEffects();
    }

    function goHome() {
      restorePageEffects();
      window.location.href = '/games';
    }

    const fullscreenEvents = ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'msfullscreenchange'];
    fullscreenEvents.forEach(event => {
      document.addEventListener(event, () => {
        const container = document.getElementById('iframe-container');
        const isFull = document.fullscreenElement;
        if (!isFull) {
          container.classList.remove('fullscreen');
          setTimeout(restorePageEffects, 300);
        }
      });
    });
  </script>

  <script src="/js/profile.js"></script>
</body>
</html>
