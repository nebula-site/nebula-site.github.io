<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">

    <style>
/* --- 1. CORE VARIABLES --- */
:root{
    /* Deep Space Palette */
    --bg-900: #02011b; /* Near Black */
    --bg-800: #0a0420; /* Darker Purple-Blue */
    --nebula-900: #3f00ff; /* Primary Blue/Purple */
    --nebula-500: #6400ff;
    --nebula-300: #a3f7ff; /* Primary Highlight (Cyan/Light Blue) */
    --text-100: #f0f8ff; /* Off-White */
    --card-bg-dark: rgba(20,0,40,0.5); /* Dark Glass base */
    --radius: 18px; /* Larger radius for modern look */
    --transition-speed: 0.4s;
    --pop-speed: 0.2s; /* Faster speed for clicks/pops */
    --error-red: #ff3333;
}

/* --- 2. KEYFRAME ANIMATIONS --- */

/* Smooth, endless background panning */
@keyframes background-pulse {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
}

/* Icon spin on reload */
.fa-spin-custom {
    animation: fa-spin 0.5s linear infinite;
}
@keyframes fa-spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* --- 3. BASE STYLES --- */
body {
    margin: 0;
    background: var(--bg-900);
    overflow: hidden;
    font-family: 'Inter', Arial, sans-serif;
    color: var(--text-100);
}

#wrapper {
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle at center, rgba(63,0,255,0.2), transparent 70%), var(--bg-800);
    background-size: 200% 200%;
    animation: background-pulse 60s ease infinite alternate;
    position: relative;
    perspective: 1000px;
}

/* --- 4. GAME FRAME & IFRAME --- */
#game-frame {
    width: 78vw;
    max-width: 1400px;
    height: 72vh;
    max-height: 800px;
    background: var(--card-bg-dark);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: 0 0 80px rgba(0,0,0,0.9), 0 0 40px rgba(63,0,255,0.25);
    border: 1px solid rgba(163,247,255,0.08);
    position: relative;
    transform: scale(1);
    transition: transform var(--transition-speed) ease-out, box-shadow var(--transition-speed) ease-out;
}

#game-frame:hover {
    transform: scale(1.01);
    box-shadow: 0 0 120px rgba(0,0,0,1), 0 0 60px rgba(63,0,255,0.5);
}

#game-frame iframe {
    width: 100%;
    height: 100%;
    border: none;
    opacity: 1; 
}

/* --- 5. BOTTOM BAR (Controls) --- */
#bottom-bar {
    position: absolute;
    bottom: 40px;
    width: 78vw;
    max-width: 1400px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 10;
    transition: transform var(--transition-speed) ease-out, opacity var(--transition-speed) ease-out;
}

#game-info {
    display: flex;
    align-items: center;
    padding: 10px 20px;
    gap: 18px;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(10px);
    border-radius: var(--radius);
    border: 1px solid rgba(163,247,255,0.1);
    box-shadow: 0 5px 20px rgba(0,0,0,0.5);
    transition: background var(--transition-speed);
}

/* ICON SIZE ADJUSTMENT (2X BIGGER: 30x20 -> 60x40) */
#game-info img {
    width: 60px; /* New Width */
    height: 40px; /* New Height */
    min-width: 60px;
    border-radius: 6px; 
    object-fit: cover;
    box-shadow: 0 0 10px rgba(0,0,0,0.7);
    transition: transform var(--transition-speed) ease;
}

#game-info:hover img {
    transform: scale(1.1);
}

#game-info span {
    font-size: 1.5rem;
    font-weight: 800;
    letter-spacing: 0.8px;
    color: var(--nebula-300);
    transition: color var(--transition-speed) ease;
}

#game-info:hover span {
    color: var(--text-100);
}

#button-group {
    display: flex;
    gap: 10px;
}

/* Control Buttons */
#button-group button {
    background: rgba(20,0,60,0.6);
    border: 1px solid rgba(163,247,255,0.1);
    color: var(--text-100);
    padding: 14px 18px;
    border-radius: var(--radius);
    cursor: pointer;
    font-size: 1.1rem;
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
    transition: background var(--pop-speed) ease, 
                border-color var(--pop-speed) ease, 
                box-shadow var(--pop-speed) ease,
                transform var(--pop-speed) ease;
    min-width: 50px;
    text-align: center;
}

#button-group button:hover {
    background: var(--nebula-900);
    border-color: var(--nebula-300);
    box-shadow: 0 0 30px rgba(63,0,255,0.5);
    transform: translateY(-4px); 
}

#button-group button:active {
    transform: translateY(-1px) scale(0.98);
    box-shadow: 0 0 5px rgba(0,0,0,0.8);
    background: var(--nebula-500);
    transition: transform 0.1s;
}

/* --- 6. ERROR OVERLAY STYLES --- */
#error-overlay {
    position: absolute;
    inset: 0;
    display: none; /* Initially hidden */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: rgba(20, 0, 0, 0.9);
    backdrop-filter: blur(10px);
    z-index: 6; 
    text-align: center;
    padding: 20px;
    border-radius: var(--radius);
}

#error-overlay i {
    font-size: 4rem;
    color: var(--error-red);
    margin-bottom: 20px;
    animation: shake 0.5s infinite;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-5px); }
    40%, 80% { transform: translateX(5px); }
}

#error-overlay h2 {
    color: var(--error-red);
    font-size: 2rem;
    margin-bottom: 10px;
}

#error-overlay p {
    color: var(--muted);
    font-size: 1.1rem;
    margin-bottom: 30px;
}

#error-overlay button {
    /* Reuse control button styling but with a red theme */
    background: var(--error-red);
    border: 1px solid var(--text-100);
    box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
    color: var(--text-100);
}

#error-overlay button:hover {
    background: #cc0000;
    transform: translateY(-2px);
    box-shadow: 0 0 30px rgba(255, 51, 51, 0.7);
}
</style>
</head>
<body>

<div id="wrapper">

    <div id="game-frame">
        <div id="error-overlay">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <h2>GAME LOAD ERROR</h2>
            <p>The game failed to load. This may be due to browser security restrictions, the game link being invalid, or the game being unavailable.</p>
            <button onclick="window.location.reload()">Try Reloading Page</button>
        </div>
        
        <iframe id="myIframe" src=""></iframe>
    </div>

    <div id="bottom-bar">

        <div id="game-info">
            <img id="game-image" src="" alt="Game Icon">
            <span id="game-name">Game Placeholder</span>
        </div>

        <div id="button-group">
            <button onclick="goHome()" title="Go Home"><i class="fa fa-house"></i></button>
            <button id="fullscreenButton" onclick="makeFullscreen()" title="Fullscreen Toggle"><i class="fa-solid fa-up-right-and-down-left-from-center"></i></button>
            <button id="reloadButton" onclick="reloadIframe()" title="Reload Game"><i class="fa fa-rotate-right"></i></button>
        </div>
    </div>

</div>

<script>
const myIframe = document.getElementById('myIframe');
const reloadButtonIcon = document.querySelector('#reloadButton i');
const errorOverlay = document.getElementById('error-overlay');

// --- DYNAMIC CONTENT SETUP ---
window.addEventListener('load', () => {
    // Retrieve dynamic data from sessionStorage
    const link = sessionStorage.getItem('gameLink');
    const name = sessionStorage.getItem('gameName') || "Error 404! No Game Found.";
    const img = sessionStorage.getItem('gameImage') || "/images/favicon.png"; 

    // NEW FALLBACK LOGIC: If no gameLink is found, redirect to /games immediately
    if (!link) {
        console.warn("No gameLink found in sessionStorage. Redirecting to home.");
        window.location.href = "/games";
        return; // Stop execution
    }

    // 1. Set the Iframe source
    myIframe.src = link;

    // 2. Populate Bottom Bar
    document.getElementById('game-name').innerText = name;
    document.getElementById('game-image').src = img;
    
    // 3. Attach error listener
    myIframe.addEventListener('error', handleError);

    document.title = name;

    function changeFavicon(src) {
         // Try to find an existing link, otherwise create a new one
         var link = document.querySelector("link[rel*='icon']") || document.createElement('link');
         link.type = 'image/x-icon';
         link.rel = 'shortcut icon';
         link.href = img; // Path to the new image
         document.getElementsByTagName('head')[0].appendChild(link);
    }

// Usage:
changeFavicon('/path/to/new-favicon.png');
    // Note: Due to cross-origin security, the 'error' event on an iframe
    // often doesn't fire for content loading issues (like blocked content). 
    // It's mainly useful for DOM errors.
});

// --- ERROR HANDLING ---
function handleError() {
    console.error("Iframe failed to load content. Displaying error overlay.");
    // Hide the iframe and show the error overlay
    myIframe.style.opacity = '0';
    errorOverlay.style.display = 'flex';
}

// --- CONTROL BAR FUNCTIONS ---
function reloadIframe() {
    const iframe = document.getElementById('myIframe');
    const src = iframe.src;
    
    if (src === 'about:blank' || src === '') return;

    // If the error overlay is visible, hide it on reload attempt
    errorOverlay.style.display = 'none';
    myIframe.style.opacity = '1';

    reloadButtonIcon.classList.add('fa-spin-custom'); 

    // Use contentWindow.location.replace for a cleaner reload
    iframe.contentWindow.location.replace(src); 

    // Stop the spin after a short delay
    setTimeout(() => {
        reloadButtonIcon.classList.remove('fa-spin-custom');
    }, 1200); 
}

function makeFullscreen() {
    const frame = document.getElementById('game-frame'); 

    const requestFS = frame.requestFullscreen || frame.webkitRequestFullscreen || frame.mozRequestFullScreen || frame.msRequestFullscreen;

    if (requestFS) {
        requestFS.call(frame).catch(err => {
            console.warn('Fullscreen request failed:', err);
            alert('Fullscreen is not available for this content in your browser or device settings.');
        });
    } else {
        alert('Fullscreen API is not supported.');
    }
}

function goHome() {
    window.location.href = "/games"; 
}


// --- FULLSCREEN SYNC LOGIC ---
const fsEvents = ['fullscreenchange', 'webkitfullscreenchange', 'mozfullscreenchange', 'MSFullscreenChange'];
fsEvents.forEach(ev => {
    document.addEventListener(ev, () => {
        const frame = document.getElementById('game-frame');
        const isFs = document.fullscreenElement === frame || document.webkitFullscreenElement === frame || document.mozFullScreenElement === frame || document.msFullscreenElement === frame;
        const btn = document.getElementById('fullscreenButton');
        
        if (btn) {
            const icon = btn.querySelector('i');
            if (isFs) {
                icon.className = 'fa-solid fa-compress';
                btn.title = 'Exit Fullscreen';
            } else {
                icon.className = 'fa-solid fa-up-right-and-down-left-from-center';
                btn.title = 'Fullscreen Toggle';
            }
        }
    });
});

</script>

</body>
</html>
