<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waffles</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="/css/menu.css">
    <script src="/js/main.js"></script>
    <script src="/js/navbar.js" defer></script>
</head>
<body>
    <div id="navbar-container"></div>
    <center>
        <br><br>
        <img class="waffles" src="/images/favicon.png" >
        <br>
    <input autocomplete="off" name="hidden" type="text" class="search animate__animated animate__fadeInDown" id="youtube-search-input" placeholder="Search for YouTube videos...">
    <br><br>
    <h2 id="results-heading" style="color:#a3f7ff;">Suggested Videos</h2>
    <div id="suggested-results" style="width:80%;margin:0 auto;"></div>
    <br>
    <div id="youtube-results" style="width: 80%; margin: 0 auto;"></div>
    </center>
    <div id="particles-js"></div>
    <script>
    // RyanRantz Shorts (add more IDs if desired)
    const ryanRantzShorts = [
        "QwqQwqQwqQw", // Example RyanRantz short (replace with real IDs)
        "QwqQwqQwqQw2" // Example RyanRantz short (replace with real IDs)
    ];

    const otherVideos = [
        "dQw4w9WgXcQ", // Rick Astley - Never Gonna Give You Up
        "9bZkp7q19f0", // PSY - GANGNAM STYLE
        "3JZ_D3ELwOQ", // Mark Ronson - Uptown Funk ft. Bruno Mars
        "L_jWHffIx5E", // Smash Mouth - All Star
        "kJQP7kiw5Fk", // Luis Fonsi - Despacito ft. Daddy Yankee
        "fJ9rUzIMcZQ", // Queen - Bohemian Rhapsody
        "CevxZvSJLk8", // Katy Perry - Roar
        "hT_nvWreIhg", // OneRepublic - Counting Stars
        "RgKAFK5djSk", // Wiz Khalifa - See You Again ft. Charlie Puth
        "60ItHLz5WEA"  // Alan Walker - Faded
    ];

    function getPreviousSearches() {
        try {
            const searches = JSON.parse(localStorage.getItem('previousSearches') || '[]');
            return Array.isArray(searches) ? searches : [];
        } catch {
            return [];
        }
    }

    function addSearchToHistory(query) {
        const searches = getPreviousSearches();
        if (query && !searches.includes(query)) {
            searches.push(query);
            localStorage.setItem('previousSearches', JSON.stringify(searches.slice(-20)));
        }
    }

    async function getRandomVideosFromSearches(count) {
        const searches = getPreviousSearches();
        const apiKey = "AIzaSyA4rOlZwmcGzSDwrxBwQWcKmXoSlfrKoPs";
        let allVideos = [];
        for (const query of searches) {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=10&key=${apiKey}`;
            const res = await fetch(url);
            const data = await res.json();
            if (data.items) {
                allVideos = allVideos.concat(data.items);
            }
        }
        // Shuffle and pick count
        allVideos = allVideos.sort(() => 0.5 - Math.random());
        return allVideos.slice(0, count);
    }

    async function getRandomPopularVideos(count) {
        const apiKey = "AIzaSyA4rOlZwmcGzSDwrxBwQWcKmXoSlfrKoPs";
        // Use a generic popular search term
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=trending&maxResults=50&key=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();
        let videos = data.items || [];
        videos = videos.sort(() => 0.5 - Math.random());
        return videos.slice(0, count);
    }

    async function fetchVideoDetails(videoId) {
        const apiKey = "AIzaSyA4rOlZwmcGzSDwrxBwQWcKmXoSlfrKoPs";
        const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${videoId}&key=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();
        return data.items && data.items[0] ? data.items[0] : null;
    }

    async function renderSuggestedVideos() {
        const resultsDiv = document.getElementById('suggested-results');
        resultsDiv.innerHTML = '<p>Loading suggestions...</p>';
        let videos = [];
        const searches = getPreviousSearches();
        if (searches.length > 0) {
            // Only use the most recent search
            const lastSearch = searches[searches.length - 1];
            const apiKey = "AIzaSyA4rOlZwmcGzSDwrxBwQWcKmXoSlfrKoPs";
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(lastSearch)}&maxResults=50&key=${apiKey}`;
            const res = await fetch(url);
            const data = await res.json();
            videos = data.items || [];
        } else {
            videos = await getRandomPopularVideos(50);
        }
        const videoCards = videos.map(video => `
            <a class="menu-button animate__animated animate__fadeInUp" href="#" onclick="playYouTubeVideo('${video.id.videoId}','${encodeURIComponent(video.snippet.title)}','${encodeURIComponent(video.snippet.thumbnails.medium.url)}'); return false;">
                <img src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}">
                <div class="overlay">
                    <div style="flex:1;">
                        <div style="font-size:1.3rem; font-weight:700; color:#a3f7ff; margin-bottom:4px;">${video.snippet.title}</div>
                    </div>
                </div>
            </a>
        `);
        resultsDiv.innerHTML = `<div class="video-grid">${videoCards.join('')}</div>`;
    }

    renderSuggestedVideos();

    async function searchYouTube(query) {
        const apiKey = "AIzaSyA4rOlZwmcGzSDwrxBwQWcKmXoSlfrKoPs";
        const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(query)}&maxResults=10&key=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();
        return data.items || [];
    }

    function renderResults(videos) {
        const resultsDiv = document.getElementById('youtube-results');
        if (videos.length === 0) {
            resultsDiv.innerHTML = '<p>No results found.</p>';
            return;
        }
        resultsDiv.innerHTML = `
            <div class="video-grid">
                ${videos.map(video => `
                    <a class="menu-button animate__animated animate__fadeInUp" href="#" onclick="playYouTubeVideo('${video.id.videoId}', '${encodeURIComponent(video.snippet.title)}', '${encodeURIComponent(video.snippet.thumbnails.medium.url)}'); return false;">
                        <img src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}">
                        <div class="overlay">
                            <div style="flex:1;">
                                <div style="font-size:1.3rem; font-weight:700; color:#a3f7ff; margin-bottom:4px;">${video.snippet.title}</div>
                            </div>
                        </div>
                    </a>
                `).join('')}
            </div>
        `;
    }

    document.getElementById('youtube-search-input').addEventListener('keydown', async function(e) {
        if (e.key === 'Enter') {
            const query = e.target.value.trim();
            if (!query) return;
            addSearchToHistory(query);
            document.getElementById('youtube-results').innerHTML = '<p>Searching...</p>';
            // Hide suggested videos and change heading
            document.getElementById('suggested-results').style.display = 'none';
            document.getElementById('results-heading').textContent = 'Search Results';
            try {
                const videos = await searchYouTube(query);
                renderResults(videos);
            } catch (err) {
                document.getElementById('youtube-results').innerHTML = '<p>Error fetching results.</p>';
            }
        }
    });
    function playYouTubeVideo(videoId, title, thumbnailUrl) {
        sessionStorage.setItem('gameLink', `https://www.youtube.com/embed/${videoId}?autoplay=1`);
        sessionStorage.setItem('gameName', decodeURIComponent(title));
        sessionStorage.setItem('gameImage', decodeURIComponent(thumbnailUrl));
        window.location.href = '/video.html';
    }
    </script>
    <style>
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 24px;
        justify-items: center;
        align-items: stretch;
        margin-top: 10px;
    }
    @media (max-width: 600px) {
        .video-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }
    }
    </style>
    <script src="/js/particles.js"></script>
    <script src="/js/particles-config.js"></script>
</body>
</html>
<br><br><br><footer style="background-color:lightblue; color:white; padding:20px; text-align:center; position:relative; bottom:0; width:100%;"> <p>Nebula, gaming meets reality!</p> <nav> <a href="/privacy.html" style="color:white; margin:0 10px;">Privacy Policy</a> <a href="/terms.html" style="color:white; margin:0 10px;">Terms of Service</a> <a href="/contact.html" style="color:white; margin:0 10px;">Contact Us</a> </nav></footer>
